var idleInterval,socket=io(),downScaleImage=function(e,t){var s=document.createElement('canvas');s.width=e.naturalWidth,s.height=e.naturalHeight;var a=s.getContext('2d');return a.drawImage(e,0,0),1>t?downScaleCanvas(s,t):s},downScaleCanvas=function(e,t){var s=Math.ceil,a=Math.floor;if(!(1>t)||!(0<t))throw'scale must be a positive number <1 ';var o=t*t,n=e.width,r=e.height,i=a(n*t),l=a(r*t),c=0,d=0,p=0,m=0,g=0,h=0,u=0,f=0,y=0,C=0,k=0,E=0,b=0,v=0,x=0,N=!1,S=!1,M=e.getContext('2d').getImageData(0,0,n,r).data,D=new Float32Array(3*i*l),O=0,I=0,A=0;for(d=0;d<r;d++)for(g=d*t,y=0|g,h=3*y*i,S=y!=(0|g+t),S&&(v=y+1-g,x=g+t-y-1),c=0;c<n;c++,p+=4)m=c*t,f=0|m,u=h+3*f,N=f!=(0|m+t),N&&(E=f+1-m,b=m+t-f-1),O=M[p],I=M[p+1],A=M[p+2],N||S?N&&!S?(C=E*t,D[u]+=O*C,D[u+1]+=I*C,D[u+2]+=A*C,k=b*t,D[u+3]+=O*k,D[u+4]+=I*k,D[u+5]+=A*k):S&&!N?(C=v*t,D[u]+=O*C,D[u+1]+=I*C,D[u+2]+=A*C,k=x*t,D[u+3*i]+=O*k,D[u+3*i+1]+=I*k,D[u+3*i+2]+=A*k):(C=E*v,D[u]+=O*C,D[u+1]+=I*C,D[u+2]+=A*C,k=b*v,D[u+3]+=O*k,D[u+4]+=I*k,D[u+5]+=A*k,k=E*x,D[u+3*i]+=O*k,D[u+3*i+1]+=I*k,D[u+3*i+2]+=A*k,k=b*x,D[u+3*i+3]+=O*k,D[u+3*i+4]+=I*k,D[u+3*i+5]+=A*k):(D[u]+=O*o,D[u+1]+=I*o,D[u+2]+=A*o);var P=document.createElement('canvas');P.width=i,P.height=l;var T=P.getContext('2d'),L=T.getImageData(0,0,i,l),U=L.data,R=0;for(p=0,u=0;R<i*l;p+=3,u+=4,R++)U[u]=s(D[p]),U[u+1]=s(D[p+1]),U[u+2]=s(D[p+2]),U[u+3]=255;return T.putImageData(L,0,0),P},title='Beyond',idleresponse=function(){socket.emit('AFK',!0),idleInterval.terminate(),idleInterval=null,document.onmousemove=back,document.onkeypress=back,document.title='(AFK) '+title},resetTimer=function(){idleInterval.postMessage(0)},timersetup=function(){idleInterval=new Worker('/idle.js'),idleInterval.onmessage=idleresponse,document.onmousemove=resetTimer,document.onkeypress=resetTimer},back=function(){idleInterval||(socket.emit('AFK',!1),timersetup()),document.title=title,document.getElementsByTagName('link')[0].href='/faceicons/favicon.png',notifs=[]};window.onfocus=back,timersetup();var rectimer,reconnected=!1,roll=function(e){var t=Math.floor,s=[];if(0<e[1].indexOf('!')&&(e[1]=e[1].slice(0,-1),e[2]='!'),'1'==e[0]&&'100'==e[1]&&e[2]){var a=90;do{var o=t(Math.random()*e[1])+1;s.push(o)}while(o>=a++)}else for(var n=0;n<e[0];n++)do{var o=t(Math.random()*e[1])+1;s.push(o)}while(e[2]&&o==e[1]);return s},stopDrag=function(t){t.stopPropagation(),t.preventDefault(),t.touches?(document.removeEventListener('touchmove',this.drag),document.removeEventListener('touchend',this.stopDrag)):(document.removeEventListener('mousemove',this.drag),document.removeEventListener('mouseup',this.stopDrag))},Outercontainer=React.createClass({displayName:'Outercontainer',getInitialState:function(){var e=[{type:'login'}];('Microsoft Internet Explorer'==navigator.appName||/edge|mobi/i.test(navigator.userAgent)||!window.chrome&&'undefined'==typeof InstallTrigger)&&e.push({type:'warning'});var t=document.URL.split('/');return t=0<=t.indexOf('rooms')?decodeURIComponent(t[t.length-1]):'',{settings:{},characters:[],modal:e,selected:null,permissions:'Guest',username:'',pass:'',players:{},socketroom:t,posx:25,posy:50}},focusf:function(t){13==t.keyCode&&'TEXTAREA'!=document.activeElement.tagName&&'INPUT'!=document.activeElement.tagName&&this.refs.OOCbar.focus(),resetTimer(t)},componentDidMount:function(){document.body.onkeypress=this.focusf;var t=this;this.props.socket.on('PlayerList',function(e,s){var a=null;'0'==s||s==t.state.socketroom?(a={players:e},e[t.state.username]&&(a.permissions=e[t.state.username].permissions)):s&&!t.state.socketroom&&(a={roomplayers:t.state.roomplayers||{}},a.roomplayers[s]=e),a&&t.setState(a)}),this.props.socket.on('UserDataUpdate',function(e){e=JSON.parse(e),t.setState(e)}),this.props.socket.on('Title',function(e){document.title=document.title.startsWith('(AFK) ')?'(AFK) '+e:e,t.state.socketroom?(document.title+=' ('+t.state.socketroom+')',title=e+' ('+t.state.socketroom+')'):title=e});var e=function(){reconnected||(console.log('Connected, logging in...'),t.props.socket.emit('login',t.state.username,t.state.pass,!t.state.socketroom||t.state.socketroom,function(e){e.settings?(console.log('Logged in successfully (as far as I can tell).'),reconnected=!0,!idleInterval&&t.props.socket.emit('AFK',!0)):console.log(e)}),rectimer=setTimeout(e,1e3))};this.props.socket.on('disconnect',function(){console.log('Disconnected.'),reconnected=!1}),this.props.socket.on('reconnect',function(){t.state.username&&(rectimer&&clearTimeout(rectimer),rectimer=setTimeout(e,100))}),window.onbeforeunload=function(s){s=s||window.event;return t.state.username&&t.handleSettings(t.state.settings,t.state.characters),s.returnValue='Logout','Logout'}},handleEnter:function(t){'Enter'===t.key&&(this.refs.OOCbar.value&&this.props.socket.emit('OOCmessage',this.refs.OOCbar.value,this.state.settings.textcolor),this.refs.OOCbar.value='',this.refs.OOCbar.placeholder='')},handleSettings:function(e,t,s){this.setState({settings:e,characters:t}),this.props.socket.emit('save',JSON.stringify({settings:e,characters:t}),s)},setUser:function(e,t){this.setState({username:e,pass:t})},contextMenu:function(t){var e=t.target;if('TEXTAREA'!=e.tagName&&('INPUT'!=e.tagName||'text'!=e.type)){t.preventDefault(),t.stopPropagation();for(var s=e.className;!s&&'main'!=e.parentNode.getAttribute('id');)e=e.parentNode,s=e.className;if(s){var a={x:t.nativeEvent.clientX,y:t.nativeEvent.clientY},o=[];switch(s){case'characterclosed':case'character':o=['Modify Derivatives','Set Active Character','Set Profile'],o.push('Delete Character');break;case'derivative':o=['Edit Derivative','Delete Derivative','Mod from Derivative','Omit Say','Omit Action','Unnamed Omit Action','Test Say','Test Action','Unnamed Test Action'],-1<['Player','Admin'].indexOf(this.state.permissions)&&o.splice(3,0,'Say','Action','Unnamed Action');break;case'chargroup':o=['New Character','Edit Group','Delete Group'];break;case'charlist':case'chargroup ungrouped':o=['New Character','New Group'];break;case'character admin':o=['Set Profile','Delete Profile'];break;case'PLentry':o=['Whisper'],'Admin'==this.state.permissions&&o.push('Make Player','Make Admin','Make Guest','Mute','Unmute','Boot','Ban');break;case'OOC message':case'OOC whisper':o=['Whisper'],'Admin'==this.state.permissions&&o.push('Make Player','Make Admin','Make Guest','Mute','Unmute','Boot','Ban');case'OOC system message':case'OOC log message':case'OOC say message':case'OOC action message':case'OOCbox':o.push('Clear OOC');break;case'IC say message':case'IC action message':o.push('View Character Profile');var n=e.getAttribute('data').split('-');n.pop(),n=n.join('-'),n==this.state.username?o.push('Edit','Full Edit','Delete Post'):this.state.settings.notify&&this.state.settings.notify[e.getAttribute('data')]?o.push('Stop Notifying (C)'):o.push('Notify for Character');case'IC narration message':e.getAttribute('data')==this.state.username?o=['Edit','Delete Post']:this.state.settings.notify&&(!n&&this.state.settings.notify[e.getAttribute('data')]||this.state.settings.notify[n])?o.push('Stop Notifying (P)'):n!=this.state.username&&o.push('Notify for Player');case'ICbox':o.unshift('Persistent Narrate'),o.unshift('Narrate'),o.push('Clear IC');break;case'Dice Command':o=['Private Roll','Delete'];}o.length&&this.setState({context:{position:a,options:o,target:e}})}}},handleContext:function(s){var e=s.target.textContent,a=this.state.context.target.getAttribute('id');a&&(a=this.state.context.target.getAttribute('id').split(','));var o={id:a,name:e};if(a&&2<=a.length&&!(isNaN(a[0])||isNaN(a[1]))&&'Whisper'!=e&&(o.charid=this.state.characters[a[0]][a[1]][0].id,3===a.length)){var n=this.state.characters[a[0]][a[1]][a[2]];o.icpos={left:n.icpos.left,top:n.icpos.top}}switch(e){case'Notify for Player':if('IC narration message'!=this.state.context.target.className){var r=this.state.settings,i=this.state.context.target.getAttribute('data').split('-');i.pop(),i=i.join('-'),r.notify||(r.notify={}),r.notify[i]={IC:!0,OOC:!1},this.handleSettings(r,this.state.characters);break}case'Notify for Character':var r=this.state.settings;r.notify||(r.notify={}),r.notify[this.state.context.target.getAttribute('data')]={IC:!0,OOC:!1},this.handleSettings(r,this.state.characters);break;case'Stop Notifying (P)':if('IC narration message'!=this.state.context.target.className){var r=this.state.settings,i=this.state.context.target.getAttribute('data').split('-');i.pop(),i=i.join('-'),r.notify||(r.notify={}),delete r.notify[i],this.handleSettings(r,this.state.characters);break}case'Stop Notifying (C)':var r=this.state.settings;r.notify||(r.notify={}),delete r.notify[this.state.context.target.getAttribute('data')],this.handleSettings(r,this.state.characters);break;case'Delete':var r=this.state.settings;r.dice.splice(+a[0].substring(4),1),this.handleSettings(r,this.state.characters);break;case'Delete Group':o.groupname=this.state.characters[a[0]][0];case'Delete Character':case'Delete Derivative':case'Clear OOC':o.cb=this.refs.OOCbox.boxClear,o.type='delete';break;case'Clear IC':o.cb=this.refs.ICbox.boxClear,o.type='delete';break;case'Delete Post':var l=this.state.context.target.getAttribute('data-room');l&&(l=l.slice(1,-1)),o.room=l,o.type='delete';break;case'Private Roll':var c=this.state.context.target.getAttribute('data').split('d'),d=roll(c);this.props.socket.emit('Dice',this.state.context.target.getAttribute('data'),d,this.state.settings.textcolor,!0);break;case'Mod from Derivative':o.type='character',o.useid=o.id[2],o.id=[o.id[0],o.id[1]];case'Modify Derivatives':case'Edit Derivatives':case'Edit Derivative':case'New Character':o.type='character';break;case'Edit Group':o.groupname=this.state.characters[a[0]][0];case'New Group':o.type='group';break;case'Edit':var p=this.state.context.target.children,l=this.state.context.target.getAttribute('data-room');l&&(l=l.slice(1,-1)),o.room=l,o.post=p[p.length-1].innerHTML,'say'===this.state.context.target.className.split(' ')[1]&&(o.post=o.post.slice(1,-1)),o.post.endsWith('*')&&(o.post=o.post.slice(0,-1));case'Whisper':o.id=a.join(','),o.data=this.state.context.target.getAttribute('data');case'Say':case'Action':case'Unnamed Action':case'Omit Say':case'Omit Action':case'Unnamed Omit Action':case'Test Say':case'Test Action':case'Unnamed Test Action':case'Narrate':case'Persistent Narrate':o.type='action';break;case'Full Edit':o.charid=this.state.context.target.getAttribute('data');var l=this.state.context.target.getAttribute('data-room');l&&(l=l.slice(1,-1)),o.room=l;var m=this.state.context.target.className.split(' ')[1];o.pt=m.charAt(0).toUpperCase()+m.slice(1);var p=this.state.context.target.children;o.post=p[p.length-1].innerHTML,'say'===this.state.context.target.className.split(' ')[1]&&(o.post=o.post.slice(1,-1)),o.post.endsWith('*')&&(o.post=o.post.slice(0,-1));case'Set Active Character':o.type='active';break;case'Set Profile':o.charid||(o.charid=o.id.join(','),o.charname=this.state.context.target.textContent);var t=this;this.props.socket.emit('Show Profile',o.charid,function(e){o.post=e,o.type='action',t.modalpush(o)});break;case'Delete Profile':o.charid=o.id.join(','),o.charname=this.state.context.target.textContent,o.type='delete';break;case'Mute':case'Unmute':case'Ban':case'Boot':case'Make Player':case'Make Admin':case'Make Guest':this.props.socket.emit('AdminCommand',e,a.join(','));break;case'View Character Profile':var i=this.state.context.target.getAttribute('data');i=i.split('-');var g=i.pop();i=i.join('-'),window.open('/characters/'+i+'/'+g+'.html');break;case'Set Notification Sound':o.type='setnotifsound';break;default:console.log('Unrecognized context command.');}this.modalpush(o)},modalpush:function(e){if(e&&e.type&&e.name){for(var t=this.state.modal,s=0;t[s];)s++;t[s]=e,this.setState({modal:t,selected:s})}},closeModal:function(e){var t=this.state.modal;delete t[e],this.setState({modal:t})},selectModal:function(e){this.setState({selected:e})},closeContext:function(){this.setState({context:null})},startDrag:function(t){t.stopPropagation(),t.preventDefault(),this.setState({vertdrag:'gutter gutter-vertical'==t.target.getAttribute('class')}),t.touches?(document.addEventListener('touchmove',this.drag),document.addEventListener('touchend',this.stopDrag)):(document.addEventListener('mousemove',this.drag),document.addEventListener('mouseup',this.stopDrag))},drag:function(t){t.touches&&(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY),t.stopPropagation(),t.preventDefault(),this.state.vertdrag?this.setState({posy:100*t.clientY/this.refs.OI.clientHeight}):this.setState({posx:100*t.clientX/document.body.clientWidth})},stopDrag:stopDrag,render:function(){var e=React.createElement('div',{className:'contextMenu',style:{display:'none'}}),t=!this.state.context&&this.state.settings.buttons?this.contextMenu:null;if(this.state.context){var s=this,a=this.state.context.options.map(function(e,t){return React.createElement('div',{key:t,className:'contextOption',onClick:s.handleContext},e)});e=this.state.context.position.y>.75*window.innerHeight?React.createElement('div',{className:'contextMenu',style:{left:this.state.context.position.x+'px',bottom:window.innerHeight-this.state.context.position.y+'px'}},a):React.createElement('div',{className:'contextMenu',style:{left:this.state.context.position.x+'px',top:this.state.context.position.y+'px'}},a)}return React.createElement('div',{style:{height:'calc(100vh - 19px)'},onContextMenu:this.contextMenu,onClick:this.closeContext},React.createElement(ModalHandler,{socket:this.props.socket,handleSettings:this.handleSettings,setUser:this.setUser,modal:this.state.modal,closeModal:this.closeModal,selectModal:this.selectModal,selected:this.state.selected,characters:this.state.characters,settings:this.state.settings,socketroom:this.state.socketroom}),e,React.createElement('div',{id:'left',style:{width:'calc('+this.state.posx+'% - 5px)'}},React.createElement(ChartabHandler,{socket:this.props.socket,handleSettings:this.handleSettings,characters:this.state.characters,settings:this.state.settings,players:this.state.players,roomplayers:this.state.roomplayers,modalpush:this.modalpush,permissions:this.state.permissions,systemmessage:this.refs.OOCbox?this.refs.OOCbox.systemmessage:null,contextMenu:this.contextMenu,socketroom:this.state.socketroom})),React.createElement('div',{className:'gutter gutter-horizontal',style:{width:'10px'},onMouseDown:this.startDrag,onTouchStart:this.startDrag}),React.createElement('div',{id:'OI',ref:'OI',style:{width:'calc('+(100-this.state.posx)+'% - 5px)'}},React.createElement('div',{id:'IC',onClick:t,style:{height:'calc('+this.state.posy+'% - 5px)'}},React.createElement(IChandler,{ref:'ICbox',socket:this.props.socket,notify:this.state.settings.notify,rooms:this.state.settings.rooms,notifSound:this.state.settings.notifSound,socketroom:!!this.state.socketroom})),React.createElement('div',{className:'gutter gutter-vertical',style:{height:'10px'},onMouseDown:this.startDrag,onTouchStart:this.startDrag}),React.createElement('div',{id:'OOC',onClick:t,style:{height:'calc('+(100-this.state.posy)+'% - 5px)'}},React.createElement(OOChandler,{ref:'OOCbox',socket:this.props.socket,notify:this.state.settings.notify,rooms:this.state.settings.rooms,notifSound:this.state.settings.notifSound,socketroom:!!this.state.socketroom}))),React.createElement('input',{className:'OOCbar',type:'text',ref:'OOCbar',placeholder:'Input an OOC message',onKeyPress:this.handleEnter}))}}),ModalHandler=React.createClass({displayName:'ModalHandler',verifyID:function(e,t,s){var a,o,n,r=this.props.characters;if(r[t[0]]&&(0==t[0]&&r[0][0]||r[t[0]][1])){if(r[t[0]][t[1]]&&r[t[0]][t[1]][0].id==e){if(s&&(!r[t[0]][t[1]][t[2]]||r[t[0]][t[1]][t[2]].icpos.left!=s.left||r[t[0]][t[1]][t[2]].icpos.top!=s.top)){for(n=0;n<r[t[0]][t[1]].length;n++)if(r[t[0]][t[1]][n].icpos.left==s.left&&r[t[0]][t[1]][n].icpos.top==s.top)return[t[0],t[1],n];return null}return t}for(a=0;a<r[t[0]].length;a++)if(r[t[0]][a][0].id==e){if(s&&(!r[t[0]][a][t[2]]||r[t[0]][a][t[2]].icpos.left!=s.left||r[t[0]][a][t[2]].icpos.top!=s.top)){for(n=0;n<r[t[0]][a].length;n++)if(r[t[0]][a][n].icpos.left==s.left&&r[t[0]][a][n].icpos.top==s.top)return[t[0],a,n];return null}return[t[0],a,t[2]]}}for(a=0;a<r.length;a++)if(r[a]!=t[0])for(o=0;o<r[a].length;o++)if(r[a][o][0].id==e){if(s&&(!r[a][o][t[2]]||r[a][o][t[2]].icpos.left!=s.left||r[a][o][t[2]].icpos.top!=s.top)){for(n=0;n<r[a][o].length;n++)if(r[a][o][n].icpos.left==s.left&&r[a][o][n].icpos.top==s.top)return[a,o,n];return null}return[a,o,t[2]]}},render:function(){var e=this,t=this.props.modal.map(function(t,s){if(t)switch(t.type){case'login':return React.createElement(LoginModal,{key:s,id:s,socket:e.props.socket,handleSettings:e.props.handleSettings,setUser:e.props.setUser,closeModal:e.props.closeModal,socketroom:e.props.socketroom});case'character':return React.createElement(CharacterModal,{key:s,id:s,socket:e.props.socket,modal:t,characters:e.props.characters,settings:e.props.settings,verifyID:e.verifyID,handleSettings:e.props.handleSettings,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});case'group':return t.accounts?React.createElement(GroupModal,{key:s,id:s,socket:e.props.socket,modal:t,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s}):React.createElement(GroupModal,{key:s,id:s,modal:t,characters:e.props.characters,settings:e.props.settings,verifyID:e.verifyID,handleSettings:e.props.handleSettings,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});case'delete':return React.createElement(DeleteModal,{key:s,id:s,socket:e.props.socket,modal:t,characters:e.props.characters,settings:e.props.settings,verifyID:e.verifyID,handleSettings:e.props.handleSettings,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});case'action':return React.createElement(ActionModal,{key:s,id:s,socket:e.props.socket,modal:t,characters:e.props.characters,settings:e.props.settings,verifyID:e.verifyID,handleSettings:e.props.handleSettings,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s,socketroom:e.props.socketroom});case'active':return React.createElement(ActiveModal,{key:s,id:s,socket:e.props.socket,modal:t,characters:e.props.characters,settings:e.props.settings,verifyID:e.verifyID,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s,socketroom:e.props.socketroom});case'notifications':return React.createElement(NotificationModal,{key:s,id:s,socket:e.props.socket,modal:t,characters:e.props.characters,settings:e.props.settings,handleSettings:e.props.handleSettings,selectModal:e.props.selectModal,isSelected:e.props.selected===s,closeModal:e.props.closeModal});case'warning':return React.createElement(WarningModal,{key:s,id:s,closeModal:e.props.closeModal});case'favicon':return React.createElement(FaviconModal,{key:s,id:s,socket:e.props.socket,modal:t,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});case'setnotifsound':return React.createElement(NotifSoundModal,{key:s,id:s,socket:e.props.socket,modal:t,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});case'narrate':return React.createElement(NarrateModal,{key:s,id:s,socket:e.props.socket,modal:t,settings:e.props.settings,handleSettings:e.props.handleSettings,closeModal:e.props.closeModal,selectModal:e.props.selectModal,isSelected:e.props.selected===s});}else return React.createElement('div',{key:s,className:'modal',style:{display:'none'}})});return React.createElement('div',{className:'modalContainer',style:{width:'100%',height:'100%'}},t)}}),startDrag=function(t){if('modal'==t.target.getAttribute('class')||'modal selectedmodal'==t.target.getAttribute('class')){t.stopPropagation(),t.preventDefault();var e=this.refs['this'].getBoundingClientRect();t.touches&&(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY,t.nativeEvent.offsetX=t.touches[0].pageX-e.left,t.nativeEvent.offsetY=t.touches[0].pageY-e.top),20>e.right-t.clientX&&20>e.bottom-t.clientY?this.setState({initialposition:{x:t.clientX,y:t.clientY},resize:!0}):this.setState({initialposition:{x:t.nativeEvent.offsetX,y:t.nativeEvent.offsetY},resize:!1}),t.touches?(document.addEventListener('touchmove',this.drag),document.addEventListener('touchend',this.stopDrag)):(document.addEventListener('mousemove',this.drag),document.addEventListener('mouseup',this.stopDrag))}},drag=function(t){t.touches&&(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY),t.stopPropagation(),t.preventDefault();var e=this.state.initialposition,s=t.clientX-e.x,a=t.clientY-e.y,o=this.refs['this'].getBoundingClientRect();this.state.resize?(s+=this.state.width,a+=this.state.height||0,this.state.minwidth>+s&&(s=this.state.minwidth),this.state.minheight&&this.state.minheight>+a&&(a=this.state.minheight),s+o.left>document.body.clientWidth&&(s=document.body.clientWidth-o.left),a+o.top>document.body.clientHeight&&(a=document.body.clientHeight-o.top),this.setState({width:s,height:a,initialposition:{x:t.clientX,y:t.clientY}})):(0>s&&(s=0),0>a&&(a=0),s+o.width>document.body.clientWidth&&(s=document.body.clientWidth-o.width),a+o.height>document.body.clientHeight&&(a=document.body.clientHeight-o.height),this.setState({x:s,y:a}))},LoginModal=React.createClass({displayName:'LoginModal',getInitialState:function(){return{loginmessage:'Please input a username and password of at least 6 characters.'}},submission:function(t){var e=t.target.getAttribute('id');t.preventDefault();var s=this,a=this.refs.username.value,o=this.refs.password.value;if(6<=a.length&&6<=o.length){this.refs.Remember.checked&&(document.cookie='username='+encodeURIComponent(a),document.cookie='password='+encodeURIComponent(md5(o)));var n=t.target.parentNode.getAttribute('id');this.props.socket.emit(e,a,md5(o),!!this.props.socketroom&&this.props.socketroom,function(e){e.settings?(s.props.handleSettings(e.settings,e.characters),s.props.setUser(a,md5(o)),s.props.closeModal(n),reconnected=!0):s.setState({loginmessage:e.code||e})})}},discon:function(t){t.preventDefault();var e=this,s=this.refs.username.value,a=this.refs.password.value;6<=s.length&&6<=a.length&&this.props.socket.emit('disconnectall',s,md5(a),function(t){e.setState({loginmessage:t.code||t})})},componentDidMount:function(){if(document.cookie&&document.cookie.match(/[; ^]?username=([^\s;]*)/)){var e=document.cookie,t=decodeURIComponent(e.match(/[; ^]?username=([^\s;]*)/)[1]),s=decodeURIComponent(e.match(/[; ^]?password=([^\s;]*)/)[1]);this.refs.password.focus();var a=this;this.props.socket.emit('login',t,s,this.props.socketroom,function(e){e.settings?(a.props.handleSettings(e.settings,e.characters),a.props.setUser(t,s),a.props.closeModal(a.refs.this.id),reconnected=!0):(a.refs.username.value=t,a.refs.password.value=s,a.setState({loginmessage:e.code||e}))})}else this.refs.username.focus()},enterCheck:function(t){13==t.keyCode&&('password'==t.target.name?this.submission(t):6<=t.target.value.length&&this.refs.password.focus())},render:function(){return React.createElement('div',{id:this.props.id,ref:'this',className:'modal',style:{textAlign:'center',height:'100%',width:'100%',paddingTop:'10px'}},React.createElement('input',{type:'text',name:'username',ref:'username',placeholder:'Username',onKeyDown:this.enterCheck}),React.createElement('br',null),React.createElement('input',{id:'login',type:'text',name:'password',ref:'password',placeholder:'Password',onKeyDown:this.enterCheck}),React.createElement('br',null),React.createElement('input',{type:'checkbox',name:'Remember',ref:'Remember',defaultChecked:!1}),React.createElement('b',null,'Remember me'),React.createElement('br',null),React.createElement('button',{type:'submit',id:'login',onClick:this.submission},'Login'),this.props.socketroom?null:React.createElement('button',{type:'submit',id:'register',onClick:this.submission},'Register'),React.createElement('br',null),React.createElement('button',{type:'submit',id:'disconnect',onClick:this.discon},'Disconnect Other Instances'),React.createElement('br',null),React.createElement('b',null,this.state.loginmessage),React.createElement('br',null),React.createElement('iframe',{src:'/worldinfo',style:{width:'95%',height:'85%'}}))}}),WarningModal=React.createClass({displayName:'WarningModal',render:function(){return React.createElement('div',{id:this.props.id,className:'modal',style:{left:'10%',top:'30%',textAlign:'center',height:'auto',width:'80%',backgroundColor:'rgb(50,50,50)'}},React.createElement('h1',{style:{color:'red',fontSize:'300%'}},React.createElement('b',null,'WARNING')),React.createElement('br',null),'Beyond has detected that you are trying to connect from an unsupported browser. Due to shaky support for various HTML functionality and the nature of various \'modern\' browsers, Beyond is only set up to support Firefox and Chrome. If you decide you wish to do this anyway, it is at your own risk.',React.createElement('br',null),React.createElement('br',null),'If this is a mobile browser in particular, I strongly advise you not to attempt to use Beyond this way, or at least not to report issues that occur when you do so. The only reason this works is because it is browser-based, and \'works\' is being generous. This platform has little to no formal support for mobile, and doing so is next to impossible as most mobile browsers are wildly inconsistent about what they support.',React.createElement('br',null),React.createElement('br',null),React.createElement('button',{type:'submit',id:'continue',onClick:this.props.closeModal.bind(null,this.props.id)},'I understand and wish to continue'),React.createElement('br',null))}}),CharacterModal=React.createClass({displayName:'CharacterModal',getInitialState:function(){return{x:'25%',y:'25%',width:300,minwidth:260,ids:[]}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,handleFIs:function(t){for(var e=t.target.files,s=[],a=0;a<e.length;a++)e[a].type.match(/image.*/)&&s.push(window.URL.createObjectURL(e[a]));this.setState({images:s})},testFont:function(t){try{var e=new Detector;t.target.value?e.detect(t.target.value)?(t.target.style['outline-color']='#0f0',t.target.style.fontFamily=t.target.value):t.target.style['outline-color']='#f00':t.target.style['outline-color']='#777'}catch(e){t.target.style['outline-color']='#777'}},fontTest:function(t){t.ctrlKey&&66==t.keyCode&&('bold'==t.target.style.fontWeight?t.target.style.fontWeight='normal':t.target.style.fontWeight='bold')},charEdit:function(t){var e=t.target.parentNode,s=this.refs.name.value,a=this.refs.faceicons.children;if(s&&1===this.props.modal.id.length||s&&a.length||1<this.props.modal.id.length&&(!this.state.ids.length||!a.length||this.state.ids.length==a.length)){var o,n=this.refs.font.value,r=this.refs.nameColor.value,l=this.refs.html.value,c=this.refs.texthtml.value,d=this.refs.color.value,p=[],m=document.createElement('canvas'),g=Math.ceil(Math.sqrt(a.length));m.width=50*g,m.height=50*g;for(var h,u,f=m.getContext('2d'),C=0;C<a.length;C++){var k=50/a[C].naturalWidth,o=downScaleImage(a[C],k);h=50*(C%g),u=50*Math.floor(C/g),f.drawImage(o,h,u,50,50),p.push({left:h,top:u})}var E=this;this.props.socket.emit('sendimage',m.toDataURL('image/png'),function(e,t){var a=E.state.ids;a&&(a=a.map(function(e){return+e.id}),a.sort(function(e,t){return e-t}));var o,i=E.props.modal,m=E.props.settings,g=E.props.characters,h=[];if(1===i.id.length?(h[0]=E.refs.group.value,h.push(g[h[0]].length),o=[]):(h=E.props.verifyID(i.charid,i.id,i.icpos),h&&(o=g[h[0]][h[1]])),i.id[2]){var u=o[h[2]];o[h[2]]={id:u.id,name:s||u.name,icon:e||u.icon,icpos:p[0]||u.icpos,nameColor:r,color:d,fontStyle:n||u.fontStyle,customHTML:l,textHTML:c}}else if(2===i.id.length&&a.length)for(C=0;C<a.length;C++){var u=o[a[C]];o[a[C]]={id:u.id,name:s||u.name,icon:e||u.icon,icpos:p[C]||u.icpos,nameColor:r,color:d,fontStyle:n||u.fontStyle,customHTML:l,textHTML:c}}else{var f=o[0]?o[0].id:t+'-'+m.characterIDs++;for(C=0;C<p.length;C++)o.push({id:f,name:s||o[0].name,icon:e,icpos:p[C],nameColor:r,color:d,fontStyle:n,customHTML:l,textHTML:c});p.length||1!==i.id.length||o.push({id:f,name:s||o[0].name,icon:'img_trans',icpos:{left:0,top:0},nameColor:r,color:d,fontStyle:n,customHTML:l,textHTML:c})}g[h[0]][h[1]]=o,E.props.handleSettings(m,g),E.props.socket.emit('Update Character',o[0]),E.props.closeModal(E.props.id)})}},select:function(t){if('IMG'==t.target.tagName&&!isNaN(t.target.id))if(t.target.src.endsWith('/faceicons/img_trans.gif')){t.target.src='/faceicons/box.png';var e=this.state.ids;e.push(t.target),this.setState({ids:e})}else{t.target.src='/faceicons/img_trans.gif';var e=this.state.ids;e.splice(e.indexOf(t.target),1),this.setState({ids:e})}},selectAll:function(){var e=[].slice.call(this.refs.img.children);e.forEach(function(e){e.src='/faceicons/box.png'}),this.setState({ids:e})},deselectAll:function(){var e=[].slice.call(this.refs.img.children);e.forEach(function(e){e.src='/faceicons/img_trans.gif'}),this.setState({ids:[]})},deleteSelected:function(){var e=this.state.ids;e&&(e=e.map(function(e){return+e.id}),e.sort(function(e,t){return e-t}).reverse());var t,s=0;if(e.length&&e.length!=this.refs.img.children.length&&'Red Button'==this.refs.delsel.className){var a=this.props.modal,t=this.props.verifyID(a.charid,a.id,a.icpos),o=this.props.characters.slice();for(s;s<e.length;s++)o[t[0]][t[1]].splice(e[s],1);this.deselectAll(),this.props.handleSettings(this.props.settings,o),this.props.socket.emit('Update Character',o[t[0]][t[1]][0]),this.refs.delsel.className=''}else this.refs.delsel.className='Red Button'},render:function(){var e,t,s,a,o,n,r,i,l,c,d,p=this.props.modal,m=null,g=React.createElement('input',{type:'file',ref:'FIs',style:{width:'100%',marginBottom:'1px'},multiple:!0,onChange:this.handleFIs});if(1==p.id.length){s=this.props.settings.textcolor||'#ffffff',a=this.props.settings.textcolor||'#ffffff',o='Times New Roman',n='',r='';var h=this.props.characters.map(function(e,t){return t?React.createElement('option',{key:t,value:t},e[0]):React.createElement('option',{key:t,value:t},'None')});m=React.createElement('select',{className:'rooms',ref:'group'},h),d=p.name}else l=this.props.verifyID(p.charid,p.id,p.icpos),l?(i=this.props.characters[l[0]][l[1]],c=i[p.useid]?p.useid:null,s=i[c||0].nameColor,a=i[c||0].color,o=i[c||0].fontStyle,n=i[c||0].customHTML,r=i[c||0].textHTML,d=p.name+' - '+i[0].name):this.props.closeModal(this.props.id);2==p.id.length&&(e=this.props.characters[l[0]][l[1]].map(function(e,t){return React.createElement('img',{key:t,id:t,src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e.icon+'.png)',backgroundPosition:'-'+e.icpos.left+'px -'+e.icpos.top+'px'}})}),t=React.createElement('div',{style:{background:'none'}},React.createElement('button',{type:'button',id:'selectall',onClick:this.selectAll},'Select All'),React.createElement('button',{type:'button',id:'delectall',onClick:this.deselectAll},'Deselect All'),React.createElement('button',{ref:'delsel',type:'button',id:'delectall',onClick:this.deleteSelected},'Delete Selected'))),3==p.id.length&&(g=React.createElement('input',{type:'file',ref:'FIs',style:{width:'100%',marginBottom:'1px'},onChange:this.handleFIs}),a=i[l[2]].color||a,s=i[l[2]].nameColor||s,o=i[l[2]].fontStyle||o,n=i[l[2]].customHTML||n,r=i[l[2]].textHTML||r,d=p.name+' - '+i[l[2]].name);var u=null,f=this.state.images;f&&f.length&&(u=f.map(function(e,t){return React.createElement('img',{src:e,key:t,width:'50px',height:'50px'})}));var y=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{className:y,ref:'this',style:{left:this.state.x,top:this.state.y,width:this.state.width},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},d),React.createElement('br',null),React.createElement('div',{ref:'img',onClick:this.select,style:{maxWidth:'100%',background:'none'}},e),t,g,React.createElement('br',null),React.createElement('span',{ref:'faceicons'},u),React.createElement('br',null),'Name: ',React.createElement('input',{type:'text',className:'char',ref:'name',placeholder:'Character Name',style:{marginBottom:'1px'}}),React.createElement('br',null),'Name Color: ',React.createElement('input',{type:'color',className:'char',ref:'nameColor',defaultValue:s}),React.createElement('br',null),'Text Color: ',React.createElement('input',{type:'color',className:'char',ref:'color',defaultValue:a}),React.createElement('br',null),'Font: ',React.createElement('input',{type:'text',className:'char',ref:'font',placeholder:'Font Style',defaultValue:o,style:{fontFamily:o},onChange:this.testFont,onKeyDown:this.fontTest}),React.createElement('br',null),'Name HTML: ',React.createElement('input',{type:'text',className:'char',ref:'html',placeholder:'Name HTML',defaultValue:n,style:{marginBottom:'1px'}}),React.createElement('br',null),'Text HTML: ',React.createElement('input',{type:'text',className:'char',ref:'texthtml',placeholder:'Text HTML',defaultValue:r,style:{marginBottom:'1px'}}),React.createElement('br',null),m?'Select a group: ':'',m,React.createElement('br',null),React.createElement('button',{type:'submit',id:'save',onClick:this.charEdit},'Save'),React.createElement('button',{type:'submit',id:'cancel',onClick:this.props.closeModal.bind(null,this.props.id)},'Cancel'),React.createElement('img',{src:'/faceicons/handle.png',width:'20px',height:'20px',style:{position:'absolute',right:0,bottom:0,pointerEvents:'none'}}))}}),FaviconModal=React.createClass({displayName:'FaviconModal',getInitialState:function(){return{x:'25%',y:'25%'}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,handleFavicons:function(t){var e=t.target.files,s=[];e[0].type.match(/image.*/)&&s.push(window.URL.createObjectURL(e[0]));1<e.length&&e[1].type.match(/image.*/)&&s.push(window.URL.createObjectURL(e[1]));this.setState({images:s})},saveFavicons:function(){if(this.refs.newfav){var e=null,t=document.createElement('canvas');t.width=this.refs.newfav.naturalWidth,t.height=this.refs.newfav.naturalWidth;var s=t.getContext('2d');s.drawImage(this.refs.newfav,0,0);var a=t.toDataURL('image/png');this.refs.newnot&&(t.width=this.refs.newnot.naturalWidth,t.height=this.refs.newnot.naturalWidth,s.clearRect(0,0,t.width,t.height),s.drawImage(this.refs.newnot,0,0),e=t.toDataURL('image/png')),this.props.socket.emit('savefavicon',a,e),this.props.closeModal(this.props.id)}},render:function(){var e=this.props.modal,t=[React.createElement('span',{key:0,id:0},'Current Favicon: ',React.createElement('img',{src:'/faceicons/favicon.png',height:'16px',width:'16px'}),React.createElement('br',null)),React.createElement('span',{key:1,id:1},'Current Notice: \xA0\xA0',React.createElement('img',{src:'/faceicons/notice.png',height:'16px',width:'16px'}))],s=[React.createElement('span',{key:0,id:0},'Current Favicon: ',React.createElement('br',null)),React.createElement('span',{key:1,id:1},'Current Notice: \xA0\xA0')],a=this.state.images;a&&a.length&&(s=[React.createElement('span',{key:0,id:0},'New Favicon: ',React.createElement('img',{ref:'newfav',src:a[0],height:'16px',width:'16px'}),React.createElement('br',null))],2==a.length&&s.push(React.createElement('span',{key:1,id:1},'New Notice: \xA0\xA0',React.createElement('img',{ref:'newnot',src:a[1],height:'16px',width:'16px'}))));var o=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{className:o,ref:'this',style:{left:this.state.x,top:this.state.y,width:'200px'},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},e.name),React.createElement('br',null),React.createElement('div',{ref:'img',style:{maxWidth:'100%',background:'none'}},t),React.createElement('input',{type:'file',ref:'FIs',style:{width:'100%',marginBottom:'1px'},multiple:!0,onChange:this.handleFavicons}),React.createElement('span',{ref:'previews'},s),React.createElement('br',null),React.createElement('button',{type:'submit',id:'save',onClick:this.saveFavicons},'Save'),React.createElement('button',{type:'submit',id:'cancel',onClick:this.props.closeModal.bind(null,this.props.id)},'Cancel'))}}),GroupModal=React.createClass({displayName:'GroupModal',getInitialState:function(){return{x:'25%',y:'25%',height:document.body.clientHeight/3,minheight:90,selected:null}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,groupEdit:function(t){var e=t.target.parentNode,s=this.refs.name.value;if(s){var a=this.props.modal,o=this.props.characters.slice(),r=[].slice.call(this.refs.chars.children);if(!a.name.startsWith('Edit')||o[a.id[0]]&&a.groupname==o[a.id[0]][0]){var i=a.name.startsWith('Edit')?o[a.id[0]]:[];i[0]=s;var l=[];r.forEach(function(e,t){'bold'==e.style.fontWeight?i.push(o[0][t]):l.push(o[0][t])}),o[0]=l,a.name.startsWith('Edit')?o[a.id[0]]=i:o.push(i),this.props.handleSettings(this.props.settings,o)}this.props.closeModal(this.props.id)}},acommand:function(){this.state.selected&&(this.props.socket.emit('AdminCommand',this.props.modal.name,this.state.selected.textContent),this.props.closeModal(this.props.id))},entrySelect:function(t){t.target.style.fontWeight='bold'==t.target.style.fontWeight?'normal':'bold'},entrySwitch:function(t){return t.target.style.fontWeight='bold',this.state.selected&&(this.state.selected.style.fontWeight='normal',t.target.textContent==this.state.selected.textContent)?void this.setState({selected:null}):void this.setState({selected:t.target})},render:function(){var e=this.props.modal,t=this.groupEdit,s='Add characters to the group?',a='Group Name',o=this;if(!this.props.characters){var n=this.refs.name?this.refs.name.value:'';t=this.acommand,s='Select who to '+e.name+'.',a='Filter';var r=e.accounts.map(function(e,t){return!n||e.toLowerCase().startsWith(n.toLowerCase())?React.createElement('div',{key:'c'+t,style:{float:'none',fontWeight:o.state.selected&&o.state.selected.textContent==e?'bold':'normal'},className:'Command',onClick:o.entrySwitch},e):null})}else var r=this.props.characters[0].map(function(e,t){return React.createElement('div',{key:'c'+t,style:{float:'none'},className:'Command',onClick:o.entrySelect},e[0].name)});var i='',l=e.name;0<e.id[0]&&(i=this.props.characters[e.id[0]][0],l+=' - '+i);var c=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{ref:'this',className:c,style:{left:this.state.x,top:this.state.y,height:this.state.height},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},l),React.createElement('br',null),React.createElement('input',{type:'text',ref:'name',placeholder:a,defaultValue:i,style:{width:'100%'}}),React.createElement('br',null),s,React.createElement('br',null),React.createElement('form',{ref:'chars',style:{overflowY:'scroll',height:this.state.height-90}},r),React.createElement('button',{type:'submit',id:'save',onClick:t},'Save'),React.createElement('button',{type:'submit',id:'cancel',onClick:this.props.closeModal.bind(null,this.props.id)},'Cancel'))}}),DeleteModal=React.createClass({displayName:'DeleteModal',getInitialState:function(){return{x:'25%',y:'25%'}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,charDelete:function(t){var e,s=t.target.parentNode,a=this.props.modal,o=this.props.characters.slice();if(!(1===a.id.length))2===a.id.length||1==o[a.id[0]][a.id[1]].length?(e=this.props.verifyID(a.charid,a.id,a.icpos),e&&o[e[0]].splice(e[1],1),this.props.socket.emit('Delete Profile',a.charid)):(e=this.props.verifyID(a.charid,a.id,a.icpos),e&&o[e[0]][e[1]].splice(e[2],1));else if(o[a.id[0]]&&a.groupname==o[a.id[0]][0]){var n=o.splice(a.id[0],1)[0];n.shift(),n.forEach(function(e){o[0].push(e)})}this.props.handleSettings(this.props.settings,o),this.props.closeModal(this.props.id)},postDelete:function(){this.props.socket.emit('Delete Post',this.props.modal.id,this.props.modal.room),this.props.closeModal(this.props.id)},clearBox:function(t){this.props.modal.cb(t),this.props.closeModal(this.props.id)},adminProfileDelete:function(){this.props.socket.emit('Delete Profile',this.props.modal.charid),this.props.closeModal(this.props.id)},render:function(){var e=this.props.modal,t=e.name,s=this.charDelete;if(e.groupname)t+=' - '+e.groupname;else if(!e.charid)'Delete Post'==e.name?s=this.postDelete:e.name.startsWith('Clear')&&(s=this.clearBox);else if(e.charname)t+=' - '+e.charname;else{var a=this.props.verifyID(e.charid,e.id,e.icpos);a?t+=' - '+this.props.characters[a[0]][a[1]][a[2]||0].name:this.props.closeModal(this.props.id)}e.name.startsWith('Delete Profile')&&(s=this.adminProfileDelete);var o=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{ref:'this',className:o,style:{left:this.state.x,top:this.state.y},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},t),React.createElement('br',null),'Are you sure?',React.createElement('br',null),React.createElement('button',{type:'submit',onClick:s},'Yes'),React.createElement('button',{type:'submit',onClick:this.props.closeModal.bind(null,this.props.id)},'No'))}}),ActionModal=React.createClass({displayName:'ActionModal',getInitialState:function(){return{x:'25%',y:'25%',width:300,minwidth:140,height:'auto',wait:!1}},componentDidMount:function(){var e=300,t=this.refs['this'].getBoundingClientRect().height,s=t-this.refs.text.getBoundingClientRect().height;this.refs.text.style.height='calc(100% - '+s+'px)',s+=this.refs.text.scrollHeight+2,s>document.body.clientHeight/2&&(e=2*this.state.width),s>.75*document.body.clientHeight&&(s=.6*document.body.clientHeight,e=.6*document.body.clientWidth),this.setState({height:s,minheight:t,width:e})},startDrag:startDrag,drag:drag,stopDrag:stopDrag,enterCheck:function(t){if(13==t.keyCode&&!t.shiftKey&&!this.refs.toggle.checked)this.post(t);else{var e=new Date;(!this.state.lasttime||1e3<e-this.state.lasttime)&&(this.props.socket.emit('Typing'),this.setState({lasttime:e}))}'Red Button'==this.refs.Cancel.className?(this.refs.Cancel.className='',this.refs.text.style['border-color']='',this.refs.text.style['outline-color']=''):'Red Button'==this.refs.Send.className&&(this.refs.Send.className='',this.refs.text.style['border-color']='',this.refs.text.style['outline-color']='')},preview:function(){var e='<body style=\'margin: 0\'><iframe width=\'100%\' height=\'100%\' src=\'data:text/html,'+encodeURIComponent(this.refs.text.value).replace(/'/g,'%27')+'\'></iframe></body>',t=window.open();t.document.open(),t.document.write(e),t.document.close()},post:function(t){t.preventDefault();var e=t.target.parentNode,s=this.props.modal,a=this.refs.text.value,o=this.refs.roomlist&&'None'!=this.refs.roomlist.value?this.refs.roomlist.value:null;if(a&&!this.state.wait){if(s.name.startsWith('Show'))return;if('Edit'==s.name)s.post!=a&&this.props.socket.emit('ICedit',a,s.id,s.room);else if('Whisper'==s.name)this.props.socket.emit('Whisper',a,s.id,s.data);else{if('Narrate'==s.name){var n=this,r=setTimeout(this.unWait,1e3);return this.props.socket.emit('Narrate',a,this.props.settings.textcolor,o,function(e){e||(clearTimeout(r),n.props.closeModal(n.props.id))}),void this.setState({wait:!0})}if('Persistent Narrate'==s.name){var n=this;return this.props.socket.emit('Narrate',a,this.props.settings.textcolor,o,function(e){e||(n.refs.text.value='')}),this.setState({wait:!0}),void setTimeout(this.unWait,1e3)}if(-1<['Edit Rules','Edit MOTD','Edit Default Profile','Edit World Info','Edit Title'].indexOf(s.name))this.props.socket.emit(s.name,a);else if('CleanLogs'==s.name){if(Number.isNaN(a))return;if(8<a&&'Red Button'!=this.refs.Send.className)return this.refs.Send.className='Red Button',this.refs.text.style['border-color']='red',void(this.refs.text.style['outline-color']='red');this.props.socket.emit('AdminCommand',s.name,a)}else{if('Set Profile'==s.name)return void this.props.socket.emit(s.name,a,s.charid);if('Input full Discord ID#'==s.name)this.props.socket.emit('AdminCommand','SetPublic',a);else{var i=this.props.verifyID(s.charid,s.id,s.icpos);if(i){var l=this.props.characters[i[0]][i[1]][i[2]],n=this,r=setTimeout(this.unWait,1e3);return this.props.socket.emit('characterPost',a,l,s.name,o,function(e){e||(clearTimeout(r),n.props.closeModal(n.props.id))}),void this.setState({wait:!0})}}}}}this.state.wait||'Persistent Narrate'==s.name||this.props.closeModal(this.props.id)},unWait:function(){this.setState({wait:!1})},closeCheck:function(){this.refs.text.value&&'Red Button'!=this.refs.Cancel.className?(this.refs.Cancel.className='Red Button',this.refs.text.style['border-color']='red',this.refs.text.style['outline-color']='red'):this.props.closeModal(this.props.id)},render:function(){var e=this.props.modal,t=e.name,s=-1<['Set Profile','Edit World Info'].indexOf(this.props.modal.name)?React.createElement('button',{type:'submit',onClick:this.preview},'Preview'):null;if(!e.charid)'Whisper'==e.name&&(t+=' - '+e.id);else if(e.charname)t+=' - '+e.charname;else{var a=this.props.verifyID(e.charid,e.id,e.icpos);a?t+=' - '+this.props.characters[a[0]][a[1]][a[2]||0].name:this.props.closeModal(this.props.id)}var o=null;if(!this.props.socketroom&&-1<['Narrate','Persistent Narrate','Say','Action','Unnamed Action','Omit Say','Omit Action','Unnamed Omit Action'].indexOf(this.props.modal.name)&&Object.keys(this.props.settings.rooms).length){var n=[React.createElement('option',{key:0},'None')],r=1;Object.keys(this.props.settings.rooms).forEach(function(e){n.push(React.createElement('option',{key:r},e)),r++}),o=React.createElement('select',{className:'room',ref:'roomlist',style:{whiteSpace:'nowrap'}},n)}var i=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{ref:'this',className:i,style:{left:this.state.x,top:this.state.y,width:this.state.width,height:this.state.height},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},t),o,React.createElement('br',null),React.createElement('textarea',{defaultValue:e.post||'',autoFocus:!0,style:{resize:'none',width:'100%',height:'auto'},ref:'text',onKeyDown:this.enterCheck}),React.createElement('br',null),React.createElement('button',{ref:'Send',type:'submit',onClick:this.post},'OK'),React.createElement('button',{ref:'Cancel',onClick:this.closeCheck},'Set Profile'==this.props.modal.name?'Close':'Cancel'),React.createElement('input',{title:'Check this to disable sending messages on Enter.',type:'checkbox',ref:'toggle',defaultChecked:this.props.settings.echeck||!1}),React.createElement('img',{src:'/faceicons/handle.png',width:'20px',height:'20px',style:{position:'absolute',right:0,bottom:0,pointerEvents:'none'}}),' ',s)}}),ActiveModal=React.createClass({displayName:'ActiveModal',getInitialState:function(){return{x:'25%',y:'25%',width:217,minwidth:217,height:'auto',scrollheight:100,scroll:!1,wait:!1,min:!1,post:this.props.modal.post,pt:this.props.modal.pt||'Action',win:'IC',rooml:'None'}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,enterCheck:function(t){if('Red Button'==this.refs.Close.className&&(this.refs.Close.className='',this.refs.text.style['border-color']='',this.refs.text.style['outline-color']=''),13==t.keyCode&&!t.shiftKey&&!this.refs.toggle.checked)this.post(t);else{var e=new Date;(!this.state.lasttime||1e3<e-this.state.lasttime)&&(this.props.socket.emit('Typing'),this.setState({lasttime:e}))}},post:function(t){t.preventDefault();var e=t.target.parentNode,s=this.props.modal,a=this.refs.text.value,o=this.refs.type.textContent,n=this.refs.win.textContent,r=null,i=this.refs.roomlist&&'None'!=this.refs.roomlist.value?this.refs.roomlist.value:null;if('IC'==n?'Unnamed'==o&&(o='Unnamed Action'):'Unnamed'==o?o='Unnamed '+n+' Action':o=n+' '+o,a&&this.state.id&&!this.state.wait){var l=this.state.id.id,c=this.props.verifyID(s.charid,s.id,s.icpos);if(c&&(r=this.props.characters[c[0]][c[1]][l],'Full Edit'!=s.name)){var d=this;this.props.socket.emit('characterPost',a,r,o,i,function(e){'Test'==n||e||(d.refs.text.value='')}),this.setState({wait:!0}),setTimeout(this.unWait,1e3)}}a&&'Full Edit'==s.name&&(this.props.socket.emit('Cedit',a,r,o,s.id,s.room),this.props.closeModal(this.props.id))},unWait:function(){this.setState({wait:!1})},select:function(t){'IMG'==t.target.tagName&&(this.state.id&&(this.state.id.src='/faceicons/img_trans.gif'),t.target.src='/faceicons/box.png',this.setState({id:t.target}))},toggle:function(t){switch(t.target.textContent){case'IC':'Full Edit'!=this.props.modal.name&&(t.target.textContent='Omit');break;case'Omit':t.target.textContent='Test';break;case'Test':t.target.textContent='IC';break;case'Action':t.target.textContent='Say';break;case'Say':t.target.textContent='Unnamed';break;case'Unnamed':t.target.textContent='Action';}},componentDidMount:function(){ReactDOM.findDOMNode(this).getBoundingClientRect().bottom>document.body.clientHeight&&this.mode();var e=217,t=this.refs['this'].getBoundingClientRect().height,s=t-this.refs.text.getBoundingClientRect().height+this.refs.text.scrollHeight+2;s>.75*document.body.clientHeight&&(s=.6*document.body.clientHeight,e=.6*document.body.clientWidth);var a=t-this.refs.img.getBoundingClientRect().height-34;this.setState({width:e,height:s,unc:a,minheight:a+100+34})},mode:function(){'Scroll'==this.refs.scrollb.textContent?(this.refs.scrollb.textContent='Default',this.refs.img.style.height=this.state.scrollheight,this.refs.img.style['overflow-y']='scroll',this.setState({scroll:!0})):(this.refs.scrollb.textContent='Scroll',this.refs.img.style.height='',this.refs.img.style['overflow-y']='auto',this.setState({scroll:!1}))},componentDidUpdate:function(e,t){if(!this.state.min){if(this.state.id){var s=this.props.verifyID(this.props.modal.charid,this.props.modal.id,null),a=this.props.characters[s[0]][s[1]][this.state.id.id];a&&(this.refs.prev.style.fontFamily=a.fontStyle,this.refs.prev.style.color=a.nameColor,a.customHTML?this.refs.prev.innerHTML=a.customHTML:this.refs.prev.textContent=a.name)}1!==this.refs.img.childElementCount||this.state.id||this.setState({id:this.refs.img.childNodes[0]});var o=this.state.unc+this.refs.img.getBoundingClientRect().height+34;this.state.height<o&&this.setState({height:o}),t.min&&(this.forceUpdate(),this.state.scroll&&(this.refs.scrollb.textContent='Default',this.refs.img.style.height=this.state.scrollheight,this.refs.img.style['overflow-y']='scroll'),this.refs.text.focus())}},focus:function(t){'room'!=t.target.className&&(this.refs.text.focus(),this.props.selectModal(this.props.id))},minimize:function(){if(!this.state.min){var e=this.refs.roomlist?this.refs.roomlist.value:'None';this.setState({min:!this.state.min,post:this.refs.text.value,pt:this.refs.type.textContent,win:this.refs.win.textContent,rooml:e})}else this.setState({min:!1})},closeCheck:function(){this.refs.text.value&&'Red Button'!=this.refs.Close.className?(this.refs.Close.className='Red Button',this.refs.text.style['border-color']='red',this.refs.text.style['outline-color']='red'):this.props.closeModal(this.props.id)},plus:function(){var e=this.state.scrollheight+50,t=this.refs['this'].getBoundingClientRect();50+t.bottom>document.body.clientHeight||(this.refs.img.style.height=e,this.setState({scrollheight:e,height:this.state.height+50}))},minus:function(){var e=this.state.scrollheight-50;50>e||(this.refs.img.style.height=e,this.setState({scrollheight:e,height:this.state.height-50}))},render:function(){var e,t='auto',s='',a=this.props.isSelected?'modal selectedmodal':'modal';this.refs.img&&(t='calc(100% - '+(this.refs.img.getBoundingClientRect().height+this.state.unc)+'px)','scroll'==this.refs.img.style['overflow-y']&&(s=this.state.scrollheight,e=React.createElement('span',{style:{position:'absolute',right:0,cursor:'default'}},React.createElement('button',{className:'Green Button',onClick:this.plus,style:{height:'18px',width:'21px'}},'+'),React.createElement('button',{className:'Red Button',onClick:this.minus,style:{height:'18px',width:'21px'}},'-'))));var o=this.props.modal,n='Active Character',r=this.props.verifyID(o.charid,o.id,o.icpos);if(o.charid&&(r?n+=' - '+this.props.characters[r[0]][r[1]][r[2]||0].name:this.props.closeModal(this.props.id)),this.state.min)return React.createElement('div',{ref:'this',className:a,style:{left:this.state.x,top:this.state.y,width:this.state.width},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},n),React.createElement('span',{onClick:this.minimize,style:{position:'absolute',right:0,top:0,cursor:'default'}},'[+]'));var i=this,l=this.props.characters[r[0]][r[1]].map(function(e,t){return i.state.id&&t==i.state.id.id?React.createElement('img',{key:t,id:t,src:'/faceicons/box.png',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e.icon+'.png)',backgroundPosition:'-'+e.icpos.left+'px -'+e.icpos.top+'px'}}):React.createElement('img',{key:t,id:t,src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e.icon+'.png)',backgroundPosition:'-'+e.icpos.left+'px -'+e.icpos.top+'px'}})}),c=null;if(!this.props.socketroom&&!1!=this.props.modal.name&&Object.keys(this.props.settings.rooms).length){var d=[React.createElement('option',{key:0},'None')],p=1;Object.keys(this.props.settings.rooms).forEach(function(e){d.push(React.createElement('option',{key:p},e)),p++}),c=React.createElement('select',{className:'room',defaultValue:this.state.rooml,ref:'roomlist',style:{whiteSpace:'nowrap',right:18},onClick:null},d)}return React.createElement('div',{ref:'this',className:a,style:{left:this.state.x,top:this.state.y,width:this.state.width,height:this.state.height},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.focus},React.createElement('span',{className:'mtitle'},n),c,React.createElement('span',{onClick:this.minimize,style:{position:'absolute',right:0,top:0,cursor:'default'}},'[-]'),React.createElement('br',null),React.createElement('div',{ref:'img',onClick:this.select,style:{height:s,maxWidth:'100%',background:'none'}},l),React.createElement('br',null),React.createElement('div',{style:{width:'100%',whiteSpace:'nowrap',background:'none'}},React.createElement('span',{ref:'prev',className:'mtitle',style:{fontWeight:'bold',width:'auto',padding:'2px 5px 0px 0px',background:'none'}}),React.createElement('span',{ref:'win',style:{width:'auto',paddingRight:'5px',background:'none'},className:'Command',onClick:this.toggle},this.state.win),React.createElement('span',{ref:'type',style:{width:'auto',background:'none'},className:'Command',onClick:this.toggle},this.state.pt),e),React.createElement('br',null),React.createElement('textarea',{defaultValue:this.state.post||'',autoFocus:!0,style:{resize:'none',width:'100%',height:t,minHeight:32},ref:'text',onKeyDown:this.enterCheck}),React.createElement('br',null),React.createElement('button',{type:'submit',onClick:this.post},'OK'),React.createElement('button',{ref:'Close',onClick:this.closeCheck},'Close'),React.createElement('button',{ref:'scrollb',type:'submit',onClick:this.mode},'Scroll'),React.createElement('input',{title:'Check this to disable sending messages on Enter.',type:'checkbox',ref:'toggle',defaultChecked:this.props.settings.echeck||!1}),React.createElement('img',{src:'/faceicons/handle.png',width:'20px',height:'20px',style:{position:'absolute',right:0,bottom:0,pointerEvents:'none'}}))}}),NotificationModal=React.createClass({displayName:'NotificationModal',getInitialState:function(){var e=[{name:'',OOC:!1,IC:!1}],t=null;return'Set Notifications'==this.props.modal.name&&this.props.settings.notify?t=this.props.settings.notify:'Set Rooms'==this.props.modal.name&&Object.getOwnPropertyNames(this.props.settings.rooms).length&&(this.props.settings.rooms[Object.keys(this.props.settings.rooms)[0]][0]?this.props.settings.rooms={}:t=this.props.settings.rooms),t&&(e=Object.keys(t).map(function(e){return{name:e,OOC:t[e].OOC,IC:t[e].IC}})),{x:'25%',y:'25%',notify:e.slice()}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,remove:function(t){var e=t.target.parentNode.id;this.state.notify.splice(e,1),this.setState({notify:this.state.notify})},increment:function(){this.state.notify.push({name:'',OOC:!1,IC:!1}),this.setState({notify:this.state.notify})},test:function(s){var e=s.target.parentNode.id;if(!('radio'==s.target.type))this.state.notify[e].name=s.target.value;else if('Both'==s.target.id)this.state.notify[e].IC=!0,this.state.notify[e].OOC=!0;else{var a='IC'==s.target.id;this.state.notify[e].IC=a,this.state.notify[e].OOC=!a}this.setState({notify:this.state.notify})},save:function(){var e={};this.state.notify.forEach(function(t){(t.OOC||t.IC)&&(e[t.name]={OOC:t.OOC,IC:t.IC})}),'Set Notifications'==this.props.modal.name?(this.props.settings.notify=e,this.props.handleSettings(this.props.settings,this.props.characters)):'Set Rooms'==this.props.modal.name&&(this.props.socket.emit('Set Rooms',Object.keys(e),Object.keys(this.props.settings.rooms)),this.props.settings.rooms=e,this.props.handleSettings(this.props.settings,this.props.characters)),this.props.closeModal(this.props.id)},render:function(){var e=this.state.notify,t=this.props.modal.name,s=this,a=e.map(function(e,t){return React.createElement('div',{key:t,id:t},React.createElement('input',{style:{width:'172px'},type:'text',ref:'name'+t,id:t,value:e.name,onChange:s.test}),React.createElement('input',{type:'radio',checked:e.IC&&!e.OOC,id:'IC',onChange:s.test}),'IC',React.createElement('input',{type:'radio',checked:e.OOC&&!e.IC,id:'OOC',onChange:s.test}),'OOC',React.createElement('input',{type:'radio',checked:e.IC&&e.OOC,id:'Both',onChange:s.test}),'Both ',React.createElement('button',{style:{width:'30px'},className:'Red Button',type:'button',onClick:s.remove},'X'))}),o=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{ref:'this',className:o,style:{width:'350px',left:this.state.x,top:this.state.y},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},t),React.createElement('br',null),a,React.createElement('br',null),React.createElement('button',{type:'button',className:'Green Button',style:{width:'100%'},onClick:this.increment},'+'),React.createElement('br',null),React.createElement('button',{type:'button',onClick:this.save},'Save'),React.createElement('button',{type:'button',onClick:this.props.closeModal.bind(null,this.props.id)},'Cancel'))}}),ChartabHandler=React.createClass({displayName:'ChartabHandler',getInitialState:function(){return{tab:'characters',open:{groups:{},characters:{},players:{}}}},shiftTab:function(t){this.setState({tab:t.target.getAttribute('id')})},toggleGroup:function(t){t.stopPropagation();var e=this.state.open,s=this.props.characters[t.target.getAttribute('id')][0];e.groups[s]=!e.groups[s],this.setState({open:e})},toggleChar:function(t){t.stopPropagation();var e=t.target.getAttribute('id').split(','),s=this.state.open,a=this.props.characters[e[0]][e[1]][0].id;s.characters[a]=!s.characters[a],this.setState({open:s})},togglePlayer:function(t){t.stopPropagation();var e=t.target.getAttribute('id'),s=this.state.open;s.players[e]=!s.players[e],this.setState({open:s})},setColor:function(){var e=this.props.settings;e.textcolor=this.refs.OOCcolor.value,this.props.handleSettings(e,this.props.characters)},toggleecheck:function(){var e=this.props.settings;e.echeck=!e.echeck,this.props.handleSettings(e,this.props.characters)},togglembut:function(){var e=this.props.settings;e.buttons=!e.buttons,this.props.handleSettings(e,this.props.characters)},toggleHideIcons:function(){var e=this.props.settings;e.hideIcons=!e.hideIcons,this.props.handleSettings(e,this.props.characters)},togglesetting:function(t){var e,s=this.props.settings,a=t.target.textContent;a.startsWith('Enter Checkbox')?e='echeck':a.startsWith('Menu Buttons')?e='buttons':a.startsWith('Compact Characters')?e='compchar':a.startsWith('Listed Icons')?e='showfi':a.startsWith('IC/OOC Icons')&&(e='hideIcons'),e&&(s[e]=!s[e],this.props.handleSettings(s,this.props.characters))},genmodal:function(t){var e=t.target.textContent,s=e.split(' ');s=s[s.length-1];var a=this;if('Clean Logs'==e)this.props.modalpush({id:[],name:'CleanLogs',type:'action'});else if(-1<['Rules','MOTD','Profile','Info','Logs'].indexOf(s)){var o=function(t){t&&(t=t),a.props.modalpush({id:[],name:e,type:'action',post:t})};'Profile'==s?this.props.socket.emit('Show '+s,null,o):this.props.socket.emit('Show '+s,o)}else if(-1<['Mute','Unmute','Ban','Unban','Player','Admin','Guest'].indexOf(s)){var o=function(t){t&&a.props.modalpush({id:[],name:e,type:'group',accounts:t})};this.props.socket.emit('List Accounts',o)}else'Notifications'==s||'Rooms'==s?this.props.modalpush({id:[],name:e,type:'notifications'}):'Public'==s?this.props.modalpush({id:[],name:'Input full Discord ID#',type:'action'}):'Edit Favicon'==e?this.props.modalpush({id:[],name:'Edit Favicon',type:'favicon'}):'Set Notification Sound'==e?this.props.modalpush({id:[],name:'Set Notification Sound',type:'setnotifsound'}):-1<['Player','Admin'].indexOf(this.props.permissions)&&this.props.modalpush({id:[],name:e,type:'action'})},setpriv:function(){this.props.socket.emit('AdminCommand','SetPublic',!1)},gendice:function(){var e=this.props.settings,t=this.refs.Nd.value+'d'+this.refs.dN.value;this.refs.exploding.checked&&(t+='!'),0<this.refs.Nd.value&&1<this.refs.dN.value&&-1<['Player','Admin'].indexOf(this.props.permissions)&&(e.dice.push(t),this.props.handleSettings(e,this.props.characters))},show:function(t){this.props.socket.emit(t.target.textContent)},roll:function(t){var e=t.target.getAttribute('data').split('d'),s=roll(e);this.props.socket.emit('Dice',t.target.getAttribute('data'),s,this.props.settings.textcolor)},dragstart:function(t){t.stopPropagation();var e;t.dataTransfer.setData('text','n'),e='derivative'==t.target.className?t.target.parentNode:document.getElementsByClassName('charlist')[0],e.addEventListener('dragover',this.dragover,!1),e.addEventListener('dragend',this.dragend,!1),e.addEventListener('drop',this.drop,!1),this.setState({dragEl:t.target})},dragover:function(t){t.target.className.startsWith(this.state.dragEl.className)&&t.target.id!=this.state.dragEl.id?t.preventDefault():('character'==this.state.dragEl.className||'characterclosed'==this.state.dragEl.className)&&t.target.className.startsWith('chargroup')&&t.preventDefault()},dragend:function(t){t.preventDefault();var e;e='derivative'==t.target.className?t.target.parentNode:document.getElementsByClassName('charlist')[0],e.removeEventListener('dragover',this.dragover,!1),e.removeEventListener('dragend',this.dragend,!1),e.removeEventListener('drop',this.drop,!1),this.setState({dragEl:null})},drop:function(t){t.preventDefault();var e,s=t.target.getBoundingClientRect();e=this.props.settings.compchar&&!this.props.settings.buttons?.5<(t.clientX-s.left)/(s.left-s.right):.5<(t.clientY-s.top)/(s.bottom-s.top);var a,o=this.state.dragEl.id.split(','),n=t.target.id.split(',');switch(this.state.dragEl.className){case'derivative':a=this.props.characters[o[0]][o[1]].splice(o[2],1)[0],a&&(+o[2]<+n[2]&&n[2]--,e&&n[2]++,this.props.characters[o[0]][o[1]].splice(n[2],0,a)),this.props.socket.emit('Update Character',this.props.characters[o[0]][o[1]][0]);break;case'characterclosed':case'character':a=this.props.characters[o[0]].splice(o[1],1)[0],a&&(n[1]?(o[0]==n[0]&&+o[1]<+n[1]&&n[1]--,e&&n[1]++,this.props.characters[n[0]].splice(n[1],0,a)):e||'1'!=n[0]?this.props.characters[n[0]].splice(1,0,a):this.props.characters[0].push(a));break;case'chargroup':if(0==n[0])break;a=this.props.characters.splice(o[0],1)[0],a&&(+o[0]<+n[0]&&n[0]--,e&&n[0]++,this.props.characters.splice(n[0],0,a));}this.props.handleSettings(this.props.settings,this.props.characters)},refresh:function(){var e=this;this.props.socket.emit('Get Character List',function(t){e.setState({charindex:t})})},charstats:function(){for(var e=this.props.characters,t=e.length-1,s=0-t,a=0,o=0;o<t+1;o++){s+=e[o].length;for(var n=0;n<e[o].length;n++)a+=e[o][n].length}this.props.systemmessage('<b>Groups:</b> '+t+',<br><b>Characters:</b> '+s+',<br><b>Derivatives:</b> '+a)},save:function(){this.props.handleSettings(this.props.settings,this.props.characters,!0)},render:function(){var e=null,t=this,s=null;switch(this.props.settings.buttons&&(s=React.createElement('button',{onClick:t.props.contextMenu,style:{float:'right',pointerEvents:'auto'}},'Menu')),this.state.tab){case'characters':var a=this.props.characters,o=a.map(function(e,o){if(0==o||t.state.open.groups[e[0]]){var n=a[o].map(function(e,n){if('string'!=typeof e){if(t.state.open.characters[e[0].id]){var r=a[o][n].map(function(e,a){return t.props.settings.compchar&&!s?React.createElement('div',{draggable:!0,key:a,id:o+','+n+','+a,className:'derivative',style:{width:'50px'},title:e.name},React.createElement('img',{src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e.icon+'.png)',backgroundPosition:'-'+e.icpos.left+'px -'+e.icpos.top+'px',pointerEvents:'none'}})):React.createElement('div',{draggable:!0,key:a,id:o+','+n+','+a,className:'derivative'},React.createElement('img',{src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e.icon+'.png)',backgroundPosition:'-'+e.icpos.left+'px -'+e.icpos.top+'px',pointerEvents:'none'}}),React.createElement('span',null,e.name,s))});return React.createElement('div',{draggable:!0,onDragStart:t.dragstart,onClick:t.toggleChar,key:n,id:o+','+n,className:'character'},React.createElement('span',{style:{pointerEvents:'none',display:t.props.settings.compchar&&!s?'block':''}},e[0].name,' [-]'),s,r)}return t.props.settings.showfi?React.createElement('div',{draggable:!0,onClick:t.toggleChar,key:n,id:o+','+n,className:'characterclosed'},React.createElement('img',{src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{backgroundImage:'url(/faceicons/'+e[0].icon+'.png)',backgroundPosition:'-'+e[0].icpos.left+'px -'+e[0].icpos.top+'px',pointerEvents:'none'}}),React.createElement('span',{style:{pointerEvents:'none'}},e[0].name,' [+]'),s):React.createElement('div',{draggable:!0,onClick:t.toggleChar,key:n,id:o+','+n,className:'character'},React.createElement('span',{style:{pointerEvents:'none'}},e[0].name,' [+]'),s)}});return'string'==typeof e[0]?React.createElement('div',{draggable:!0,onClick:t.toggleGroup,key:o,id:o,className:'chargroup'},React.createElement('span',{style:{pointerEvents:'none'},className:'group'},e[0],' [-]'),s,n):React.createElement('div',{id:0,key:o,className:'chargroup ungrouped'},n)}return React.createElement('div',{draggable:!0,onClick:t.toggleGroup,key:o,id:o,className:'chargroup'},React.createElement('span',{className:'group',style:{pointerEvents:'none'}},e[0],' [+]'),s)});1==a.length&&0==a[0].length&&(o=[React.createElement('div',{id:0,key:0,className:'chargroup ungrouped'},'Right-click to create a character!')]),e=React.createElement('div',{id:0,onDragStart:t.dragstart,onClick:this.props.settings.buttons?t.props.contextMenu:null,className:'charlist'},o);break;case'players':var n=this.props.players;e=Object.keys(n).map(function(e,t){return React.createElement('div',{id:e,key:t,className:'PLentry'},n[e].status?'('+n[e].status+') ':'',e+' - '+n[e].permissions,s)});var r=e.length;if(this.props.roomplayers)var i=this.props.roomplayers,l=Object.keys(i).forEach(function(a){t.props.settings.rooms&&t.props.settings.rooms[a]&&Object.keys(i[a]).length&&(e.push(React.createElement('h3',{key:r++,style:{pointerEvents:'none',textAlign:'center'}},'-',React.createElement('br',null),a,React.createElement('br',null),'-')),Object.keys(i[a]).forEach(function(t){e.push(React.createElement('div',{id:t,data:a,key:r++,className:'PLentry'},i[a][t].status?'('+i[a][t].status+') ':'',t+' - '+i[a][t].permissions,s))}))});e=React.createElement('div',{className:'playlist'},e);break;case'commands':e=[React.createElement('div',{key:'0',className:'Command',onClick:this.togglesetting},'Enter Checkbox '+(this.props.settings.echeck?'ON':'OFF')),React.createElement('div',{key:'1',className:'Command',onClick:this.togglesetting},'Menu Buttons '+(this.props.settings.buttons?'ON':'OFF')),React.createElement('div',{key:'2',className:'Command',onClick:this.togglesetting},'Compact Characters '+(this.props.settings.compchar?'ON':'OFF')),React.createElement('div',{key:'3',className:'Command',onClick:this.togglesetting},'Listed Icons '+(this.props.settings.showfi?'ON':'OFF')),React.createElement('div',{key:'4',className:'Command',onClick:this.togglesetting},'IC/OOC Icons '+(this.props.settings.hideIcons?'OFF':'ON')),React.createElement('div',{key:'5',className:'Command'},React.createElement('span',null,'Set Text Color'),React.createElement('input',{type:'color',ref:'OOCcolor',style:{backgroundColor:'black'},onChange:this.setColor,defaultValue:this.props.settings.textcolor})),React.createElement('div',{key:'6',className:'Command',onClick:function(){window.open(t.props.socketroom?'/logs/'+t.props.socketroom:'/logs')}},'Open Logs'),React.createElement('div',{key:'7',className:'Command',onClick:function(){window.open('/database')}},'Open Database'),React.createElement('div',{key:'8',className:'Command',onClick:function(){window.open('/characters')}},'Open Character Database'),React.createElement('div',{key:'9',className:'Command',onClick:this.genmodal},'Narrate'),React.createElement('div',{key:'10',className:'Command',onClick:this.genmodal},'Set Notifications'),React.createElement('div',{key:'12',className:'Command',onClick:this.genmodal},'Set Notification Sound'),React.createElement('div',{key:'13',className:'Command',onClick:function(){cacheNotifSound(null)}},'Clear Notification Sound'),React.createElement('div',{key:'14',className:'Command',onClick:this.show},'Show Rules'),React.createElement('div',{key:'15',className:'Command',onClick:this.show},'Show MOTD'),React.createElement('div',{key:'16',className:'Command',onClick:function(){window.open('/worldinfo')}},'Show World Info'),React.createElement('div',{key:'17',className:'Command',onClick:this.genmodal},'Show Default Profile'),React.createElement('div',{key:'18',className:'Command',onClick:this.charstats},'Show Charlist Stats'),React.createElement('div',{key:'19',className:'Diceee'},React.createElement('span',{onClick:this.gendice,className:'Command'},'Create Dice'),' ',React.createElement('input',{type:'number',ref:'Nd',min:'1',style:{width:'10%',textAlign:'center'}}),'d',React.createElement('input',{type:'number',ref:'dN',min:'1',style:{width:'10%',textAlign:'center'}}),React.createElement('input',{type:'checkbox',ref:'exploding'}),'!')],this.props.socketroom||e.splice(11,0,React.createElement('div',{key:'11',className:'Command',onClick:this.genmodal},'Set Rooms'));var t=this;this.props.settings.dice.forEach(function(a,o){e.push(React.createElement('div',{key:20+o,id:'Dice'+o,className:'Dice Command',data:a,onClick:t.roll},a,s))}),e=React.createElement('div',{className:'playlist'},e);break;case'admin':if(e=[React.createElement('div',{key:'0',className:'Command',onClick:this.genmodal},'Edit Rules'),React.createElement('div',{key:'1',className:'Command',onClick:this.genmodal},'Edit MOTD'),React.createElement('div',{key:'2',className:'Command',onClick:this.genmodal},'Edit Default Profile'),React.createElement('div',{key:'3',className:'Command',onClick:this.genmodal},'Edit World Info'),React.createElement('div',{key:'4',className:'Command',onClick:this.genmodal},'Edit Title'),React.createElement('div',{key:'5',className:'Command',onClick:this.genmodal},'Edit Favicon'),React.createElement('div',{key:'6',className:'Command',onClick:this.genmodal},'Set Public'),React.createElement('div',{key:'7',className:'Command',onClick:this.setpriv},'Set Private'),React.createElement('div',{key:'8',className:'Command',onClick:this.genmodal},'Mute'),React.createElement('div',{key:'9',className:'Command',onClick:this.genmodal},'Unmute'),React.createElement('div',{key:'10',className:'Command',onClick:this.show},'List Bans'),React.createElement('div',{key:'11',className:'Command',onClick:this.genmodal},'Ban'),React.createElement('div',{key:'12',className:'Command',onClick:this.genmodal},'Unban'),React.createElement('div',{key:'13',className:'Command',onClick:this.genmodal},'Make Player'),React.createElement('div',{key:'14',className:'Command',onClick:this.genmodal},'Make Admin'),React.createElement('div',{key:'15',className:'Command',onClick:this.genmodal},'Make Guest'),React.createElement('div',{key:'16',className:'Command',onClick:this.genmodal},'Clean Logs'),React.createElement('div',{key:'17',className:'Command',onClick:this.genmodal},'Show Admin Logs'),React.createElement('div',{key:'18',className:'Command',onClick:this.refresh},'Open Lists')],this.state.charindex){var a=this.state.charindex,o=a.map(function(e,s){var o=a[s][0].id.split('-');o.pop();var n=o.join('-');if(t.state.open.players[n]){var r=a[s].map(function(e,t){return React.createElement('div',{key:t,id:e.id,className:'character admin'},React.createElement('span',{style:{pointerEvents:'none'}},e.name))});return React.createElement('div',{onClick:t.togglePlayer,key:s,id:n,className:'chargroup admin'},React.createElement('span',{style:{pointerEvents:'none'},className:'group'},n,' [-]'),r)}return React.createElement('div',{onClick:t.togglePlayer,key:s,id:n,className:'chargroup admin'},React.createElement('span',{className:'group',style:{pointerEvents:'none'}},n,' [+]'))});e.push(o)}e=React.createElement('div',{className:'playlist'},e);}var c='Admin'==this.props.permissions?React.createElement('li',null,React.createElement('div',{className:'tablink',id:'admin',onClick:this.shiftTab},'Admin Commands')):null;return React.createElement('div',{className:'options'},React.createElement('style',null,'div#OI img {display:'+(this.props.settings.hideIcons?'none':'inline')+'}'),React.createElement('ul',{className:'tab',style:{listStyleType:'none'}},React.createElement('li',null,React.createElement('div',{className:'tablink',id:'characters',onClick:this.shiftTab},'Characters')),React.createElement('li',null,React.createElement('div',{className:'tablink',id:'players',onClick:this.shiftTab},'Players Online')),React.createElement('li',null,React.createElement('div',{className:'tablink',id:'commands',onClick:this.shiftTab},'Player Commands')),c),e)}}),Message=React.createClass({displayName:'Message',htmlupdate:function(){var e=this.props.message,t=e.className.split(' ')[1],s=e.post;if(this.refs.post&&('say'==t&&(s='"'+s+'"'),this.refs.post.innerHTML=s),this.refs.name){var a=e.character.customHTML||e.character.name;switch(t){case'say':a+=':';case'action':a+=' ';}e.character.customHTML?this.refs.name.innerHTML=a:this.refs.name.textContent=a,this.refs.name.style.display=e.unnamed?'none':'initial'}},componentDidMount:function(){if(this.props.highlight){var e=ReactDOM.findDOMNode(this);e.style.transition='0.5s',e.style['background-color']='rgba(255,255,0,0.3)',setTimeout(this.read,4e3)}this.htmlupdate()},read:function(){var e=ReactDOM.findDOMNode(this),t=document.getElementById(this.props.message.className.split(' ')[0]).getBoundingClientRect(),s=e.getBoundingClientRect();s.bottom<t.top||s.top>t.bottom?setTimeout(this.read,4e3):e.style['background-color']=null},componentDidUpdate:function(){this.htmlupdate()},render:function(){var e=this.props.message,t=this.props.socketroom,s=e.character,a=e.className.split(' ')[1],o=!t&&e.room&&'0'!=e.room?'['+e.room+']':null;switch(a){case'message':return React.createElement('div',{id:e.username,data:e.room,className:e.className},o,'( ',React.createElement('b',null,e.username+': '),React.createElement('span',{ref:'post',style:{color:e.color}}),' )','\r');case'whisper':if(e.username)return React.createElement('div',{id:e.username,data:e.room,className:e.className},'( ',React.createElement('b',null,e.username+' whispered to you: '),React.createElement('span',{ref:'post'}),' )','\r');if(e.target)return React.createElement('div',{className:e.className},'( ',React.createElement('b',null,'You whispered to '+e.target+': '),React.createElement('span',{ref:'post'}),' )','\r');case'narration':return React.createElement('div',{id:e.id,data:e.username,className:e.className},o,React.createElement('br',null),React.createElement('span',{ref:'post',style:{color:e.color}}),'\r');case'dice':return React.createElement('div',{className:e.className},o,React.createElement('span',{ref:'post',style:{color:e.color}}),'\r');case'log':return React.createElement('div',{className:e.className},o,'| '+e.username+' '+e.post+' |','\r');case'system':return React.createElement('div',{className:e.className},o,React.createElement('span',{ref:'post'}),'\r');case'say':case'action':var n=s.id.split('-'),r=n.pop();n=n.join('-');var i=[];return e.id&&i.push(s.id),React.createElement('div',{id:e.id,data:i,"data-room":o,className:e.className,style:{fontFamily:s.fontStyle}},React.createElement('a',{href:'/characters/'+n+'/'+r+'.html',target:'_blank'},React.createElement('img',{src:'/faceicons/img_trans.gif',height:'50px',width:'50px',style:{cursor:'pointer',backgroundImage:'url(/faceicons/'+s.icon+'.png)',backgroundPosition:'-'+s.icpos.left+'px -'+s.icpos.top+'px'}})),o,' ',React.createElement('span',{ref:'name',style:{fontWeight:'bold',color:s.nameColor}}),React.createElement('span',{ref:'post',style:{color:s.color}}),'\r');}}}),IChandler=React.createClass({displayName:'IChandler',getInitialState:function(){return{messages:[],ids:{}}},boxClear:function(){var e=this.state.messages.slice(),t=this.state.ids;this.setState({messages:[],ids:{}}),this.forceUpdate()},shouldComponentUpdate:function(e,t){return t.messages.length!==this.state.messages.length},componentWillUpdate:function(){this.scroll=Math.ceil(this.refs.box.scrollTop)+this.refs.box.offsetHeight>=this.refs.box.scrollHeight},componentDidUpdate:function(){this.scroll&&(this.refs.box.scrollTop=this.refs.box.scrollHeight)},componentDidMount:function(){var e=this;this.props.socket.on('ICmessage',function(t){if(e.props.socketroom||!t.room||'0'==t.room||e.props.rooms[t.room]&&e.props.rooms[t.room].IC){var s=e.state.messages.slice(),a=e.state.ids,o=s[a[t.id]];if(o){var n=o.props.message;n.post=t.post,'boolean'==typeof t.unnamed&&(n.unnamed=t.unnamed),t.character&&(n.character=t.character),t.className&&(n.className=t.className),s[a[t.id]]=React.cloneElement(o,n)}else{a[t.id]=s.length;var r=!1;e.props.notify&&(e.props.notify[t.username]&&e.props.notify[t.username].IC?(r=!0,'visible'!=document.visibilityState&&addNotification(t.username)):t.character&&(e.props.notify[t.character.name]&&e.props.notify[t.character.name].IC||e.props.notify[t.character.id]&&e.props.notify[t.character.id].IC)&&(r=!0,'visible'!=document.visibilityState&&addNotification(t.character.name))),s.push(React.createElement(Message,{key:s.length,message:t,highlight:r,socketroom:e.props.socketroom}))}e.setState({messages:s,ids:a}),o&&e.forceUpdate()}}),this.props.socket.on('ICedit',function(t){var s=e.state.messages.slice(),a=e.state.ids,o=s[a[t.id]];if(o){var n=o.props.message;n.post=t.post,'boolean'==typeof t.unnamed&&(n.unnamed=t.unnamed),t.character&&(n.character=t.character),t.className&&(n.className=t.className),s[a[t.id]]=React.cloneElement(o,n),e.setState({messages:s}),e.forceUpdate()}}),this.props.socket.on('ICdel',function(t){var s=e.state.messages.slice(),a=e.state.ids,o=s[a[t]];o&&(delete s[a[t]],delete a[t],e.setState({messages:s,ids:a}),e.forceUpdate())})},render:function(){return React.createElement('div',{ref:'box',className:'ICbox',id:'ICbox'},this.state.messages)}}),OOChandler=React.createClass({displayName:'OOChandler',getInitialState:function(){return{messages:[]}},boxClear:function(){this.setState({messages:[]}),this.forceUpdate()},systemmessage:function(e){var t=this.state.messages.slice();t.push(React.createElement(Message,{key:t.length,message:{post:e,className:'OOC system message'}})),this.setState({messages:t})},shouldComponentUpdate:function(e,t){return t.messages.length!==this.state.messages.length},componentWillUpdate:function(){this.scroll=Math.ceil(this.refs.box.scrollTop)+this.refs.box.offsetHeight>=this.refs.box.scrollHeight},componentDidUpdate:function(){this.scroll&&(this.refs.box.scrollTop=this.refs.box.scrollHeight)},componentDidMount:function(){var e=this;this.props.socket.on('OOCmessage',function(t){if(e.props.socketroom||!t.room||'0'==t.room||e.props.rooms[t.room]&&e.props.rooms[t.room].OOC){var s=e.state.messages.slice(),a=!1;('whisper'==t.className.split(' ')[1]&&t.username||t.character&&e.props.notify&&(e.props.notify[t.username]&&e.props.notify[t.username].OOC||t.character&&e.props.notify[t.character.name]&&e.props.notify[t.character.name].OOC))&&(a=!0,'visible'!=document.visibilityState&&addNotification(t.username)),s.push(React.createElement(Message,{key:s.length,message:t,highlight:a,socketroom:e.props.socketroom})),e.setState({messages:s})}}),this.props.socket.on('disconnect',function(){var t=e.state.messages.slice();t.push(React.createElement(Message,{key:t.length,message:{username:'You',post:'have disconnected.',className:'OOC log message'}})),e.setState({messages:t})})},render:function(){return React.createElement('div',{ref:'box',className:'OOCbox'},this.state.messages)}}),NotifSoundModal=React.createClass({displayName:'NotifSoundModal',getInitialState:function(){return{x:'25%',y:'25%'}},startDrag:startDrag,drag:drag,stopDrag:stopDrag,handleNotifSound:function(t){t.target.files[0].type.match(/audio/g)?this.setState({snd:t.target.files[0]}):delete this.state.snd},saveNotifSound:function(){cacheNotifSound(this.state.snd)},render:function(){var e=this.props.modal,t=this.props.isSelected?'modal selectedmodal':'modal';return React.createElement('div',{className:t,ref:'this',style:{left:this.state.x,top:this.state.y,width:'200px'},onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:this.props.selectModal.bind(null,this.props.id)},React.createElement('span',{className:'mtitle'},e.name),React.createElement('br',null),React.createElement('input',{type:'file',accept:'audio/*',ref:'notifSoundFile',style:{width:'100%',marginBottom:'1px'},onChange:this.handleNotifSound}),React.createElement('button',{type:'submit',id:'save',onClick:this.saveNotifSound},'Save'),React.createElement('button',{type:'submit',id:'cancel',onClick:this.props.closeModal.bind(null,this.props.id)},'Cancel'))}}),reloadNotifSound=!0,canPlaySound=!1;function playNotifSound(){var e=document.getElementById('notifSoundPlayer');reloadNotifSound?(reloadNotifSound=!1,caches.match('/notifSound').then(t=>{t&&t.ok&&(canPlaySound&&(window.URL.revokeObjectURL(e.src),canPlaySound=!1),t.blob().then(t=>{var s=window.URL.createObjectURL(t);e.src=s,canPlaySound=!0,e.load(),e.play(),setTimeout(()=>{e.pause(),e.currentTime=0},3e3)}))})):canPlaySound&&(e.play(),3<e.duration&&setTimeout(()=>{e.pause(),e.currentTime=0},3e3))}function cacheNotifSound(e){caches.open('notifSound').then(t=>{if(e)return reloadNotifSound=!0,t.put('/notifSound',new Response(e));var s=document.getElementById('notifSoundPlayer');return s.pause(),canPlaySound&&(window.URL.revokeObjectURL(s.src),canPlaySound=!1),t.delete('/notifSound')})}var notifUpdater,notifs=[];function addNotification(e){1==notifs.push(e)&&(notifUpdater=setInterval(displayNotifs,1e3)),playNotifSound()}function displayNotifs(){return 0==notifs.length?void(notifUpdater&&(clearInterval(notifUpdater),notifUpdater=null)):void(document.title=1==notifs.length?'Post from '+notifs[0]+'!':notifs.length+' unread posts!',document.getElementsByTagName('link')[0].href='/faceicons/notice.png')}ReactDOM.render(React.createElement(Outercontainer,{socket:socket}),document.getElementById('main'));
